import{c as e,s as t}from"./vendor-state-Jewp0_hO.js";const i={preferences:{enabled:!0,sessionComplete:{enabled:!0,sound:!0,duration:10,showTaskInfo:!0},breakReminders:{enabled:!0,sound:!0,frequency:"smart",duration:15,smartThreshold:90},dailyReview:{enabled:!0,time:"18:00",sound:!1,weekendsIncluded:!1},weeklyReview:{enabled:!0,dayOfWeek:0,time:"19:00",sound:!1},goalAchievements:{enabled:!0,sound:!0,showProgress:!0},streakMilestones:{enabled:!0,sound:!0,milestones:[7,14,30,60,100]},idleDetection:{enabled:!0,threshold:5,sound:!1},systemSleep:{enabled:!0,sound:!0},focusMode:{suppressOtherNotifications:!0,allowBreakReminders:!0,allowUrgentOnly:!1}},activeBreakSuggestion:null,activeReviewPrompt:null,dismissedSuggestions:[],snoozedUntil:null,nextDailyReview:null,nextWeeklyReview:null,lastBreakTime:null,sessionsSinceLastBreak:0,totalWorkTimeSinceBreak:0},s=e()(t((e,t)=>({...i,updatePreferences:async i=>{try{if(!(await fetch("http://localhost:8765/api/settings/notification-preferences",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Failed to save notification preferences");e({preferences:i}),t().scheduleNextReviews(),localStorage.setItem("notificationPreferences",JSON.stringify(i))}catch(s){throw s}},loadPreferences:async()=>{try{const i=await fetch("http://localhost:8765/api/settings/notification-preferences");if(i.ok){const t=await i.json();e({preferences:t})}else{const t=localStorage.getItem("notificationPreferences");if(t){const i=JSON.parse(t);e({preferences:i})}}t().scheduleNextReviews()}catch(i){}},showBreakSuggestion:i=>{const s=t();s.canShowNotification("breakReminders")&&(s.snoozedUntil&&Date.now()<s.snoozedUntil||e({activeBreakSuggestion:i}))},dismissBreakSuggestion:()=>{const i=t();i.activeBreakSuggestion&&e({activeBreakSuggestion:null,dismissedSuggestions:[...i.dismissedSuggestions,`${i.activeBreakSuggestion.type}_${Date.now()}`]})},snoozeBreakSuggestion:t=>{e({activeBreakSuggestion:null,snoozedUntil:Date.now()+60*t*1e3})},acceptBreakSuggestion:i=>{e({activeBreakSuggestion:null}),t().recordBreakTaken()},showReviewPrompt:i=>{const s=t();s.preferences.enabled&&("daily"!==i.type||s.preferences.dailyReview.enabled)&&("weekly"!==i.type||s.preferences.weeklyReview.enabled)&&e({activeReviewPrompt:i})},dismissReviewPrompt:()=>{e({activeReviewPrompt:null})},snoozeReviewPrompt:i=>{const s=t();if(e({activeReviewPrompt:null}),"daily"===s.activeReviewPrompt?.type){const t=new Date(Date.now()+60*i*1e3);e({nextDailyReview:t})}else if("weekly"===s.activeReviewPrompt?.type){const t=new Date(Date.now()+60*i*1e3);e({nextWeeklyReview:t})}},submitReviewResponse:async i=>{try{if(!(await fetch("http://localhost:8765/api/reviews",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Failed to save review response");e({activeReviewPrompt:null}),t().scheduleNextReviews()}catch(s){throw s}},recordBreakTaken:()=>{e({lastBreakTime:Date.now(),sessionsSinceLastBreak:0,totalWorkTimeSinceBreak:0})},incrementSessionCount:()=>{e(e=>({sessionsSinceLastBreak:e.sessionsSinceLastBreak+1}))},addWorkTime:t=>{e(e=>({totalWorkTimeSinceBreak:e.totalWorkTimeSinceBreak+t}))},checkForBreakSuggestion:()=>{const e=t();if(!e.canShowNotification("breakReminders")||e.activeBreakSuggestion)return;const{preferences:i,sessionsSinceLastBreak:s,totalWorkTimeSinceBreak:n}=e,o=i.breakReminders;let a=!1,r=null;if(n>=120)a=!0,r={type:"time_based",reason:`You've been working for ${Math.round(n)} minutes. Time for a break!`,suggestedDuration:15,confidence:.9,sessionsSinceLastBreak:s,totalWorkTime:n};else if("smart"!==o.frequency){s>=("after_each"===o.frequency?1:"after_2"===o.frequency?2:3)&&(a=!0,r={type:"pattern_based",reason:`You've completed ${s} sessions. Consider taking a break.`,suggestedDuration:10,confidence:.8,sessionsSinceLastBreak:s,totalWorkTime:n})}else"smart"===o.frequency&&n>=o.smartThreshold&&(a=!0,r={type:"productivity_based",reason:"Based on your patterns, a break now could improve your focus.",suggestedDuration:Math.min(20,Math.round(n/6)),confidence:.75,sessionsSinceLastBreak:s,totalWorkTime:n});a&&r&&t().showBreakSuggestion(r)},scheduleNextReviews:()=>{const{preferences:i}=t(),s=new Date;if(i.dailyReview.enabled){const[t,n]=i.dailyReview.time.split(":").map(Number),o=new Date;if(o.setHours(t,n,0,0),o<=s&&o.setDate(o.getDate()+1),!i.dailyReview.weekendsIncluded)for(;0===o.getDay()||6===o.getDay();)o.setDate(o.getDate()+1);e({nextDailyReview:o})}if(i.weeklyReview.enabled){const[t,n]=i.weeklyReview.time.split(":").map(Number),o=new Date;o.setHours(t,n,0,0);const a=(i.weeklyReview.dayOfWeek-o.getDay()+7)%7;0===a&&o<=s?o.setDate(o.getDate()+7):o.setDate(o.getDate()+a),e({nextWeeklyReview:o})}},canShowNotification:e=>{const i=t();if(!i.preferences.enabled)return!1;if(i.isInFocusMode()){const t=i.preferences.focusMode;if(t.suppressOtherNotifications){if("breakReminders"===e&&!t.allowBreakReminders)return!1;if(!t.allowUrgentOnly&&"breakReminders"!==e)return!1}}const s=i.preferences[e];return"object"!=typeof s||!("enabled"in s)||s.enabled},isInFocusMode:()=>!1,clearSnoozedState:()=>{e({snoozedUntil:null})}})));s.getState().loadPreferences(),setInterval(()=>{const e=s.getState(),t=new Date;if(e.nextDailyReview&&t>=e.nextDailyReview){const t={type:"daily",title:"Daily Reflection",questions:[{id:"productivity_rating",type:"rating",question:"How would you rate your productivity today?",required:!0},{id:"accomplishments",type:"text",question:"What did you accomplish today?",required:!1},{id:"challenges",type:"text",question:"What challenges did you face?",required:!1},{id:"tomorrow_focus",type:"text",question:"What will you focus on tomorrow?",required:!1}]};e.showReviewPrompt(t)}if(e.nextWeeklyReview&&t>=e.nextWeeklyReview){const t={type:"weekly",title:"Weekly Review",questions:[{id:"week_rating",type:"rating",question:"How would you rate this week overall?",required:!0},{id:"goals_achieved",type:"yes_no",question:"Did you achieve your main goals this week?",required:!0},{id:"biggest_win",type:"text",question:"What was your biggest win this week?",required:!1},{id:"improvement_area",type:"text",question:"What area would you like to improve next week?",required:!1},{id:"next_week_goals",type:"text",question:"What are your main goals for next week?",required:!1}]};e.showReviewPrompt(t)}e.snoozedUntil&&Date.now()>=e.snoozedUntil&&e.clearSnoozedState()},6e4);export{s as u};
//# sourceMappingURL=notificationStore-D2EvFRZ9.js.map
