import{c as e,d as t}from"./vendor-state-Jewp0_hO.js";const s="http://localhost:8765/api",a=e=>({...e,dueDate:e.dueDate?new Date(e.dueDate):void 0,completedAt:e.completedAt?new Date(e.completedAt):void 0,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}),r=e()(t((e,t)=>({tasks:[],filteredTasks:[],filters:{},isLoading:!1,error:null,selectedTask:null,fetchTasks:async r=>{e({isLoading:!0,error:null});try{const o=new URLSearchParams;r?.categoryId&&o.append("categoryId",r.categoryId.toString()),r?.status&&o.append("status",r.status),r?.priority&&o.append("priority",r.priority);const i=await fetch(`${s}/tasks?${o}`),d=await i.json();if(!d.success)throw new Error(d.error?.message||"Failed to fetch tasks");const n=(d.data||[]).map(a);e({tasks:n,filteredTasks:t().applyFilters(n,t().filters),isLoading:!1})}catch(o){e({error:o instanceof Error?o.message:"Failed to fetch tasks",isLoading:!1})}},createTask:async r=>{e({isLoading:!0,error:null});try{const o=await fetch(`${s}/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),i=await o.json();if(!i.success)throw new Error(i.error?.message||"Failed to create task");const d=i.data,n=a(d),l=[n,...t().tasks];return e({tasks:l,filteredTasks:t().applyFilters(l,t().filters),isLoading:!1}),n}catch(o){throw e({error:o instanceof Error?o.message:"Failed to create task",isLoading:!1}),o}},updateTask:async(r,o)=>{e({isLoading:!0,error:null});try{const i=await fetch(`${s}/tasks/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),d=await i.json();if(!d.success)throw new Error(d.error?.message||"Failed to update task");const n=d.data,l=a(n),c=t().tasks.map(e=>e.id===r?l:e);return e({tasks:c,filteredTasks:t().applyFilters(c,t().filters),selectedTask:t().selectedTask?.id===r?l:t().selectedTask,isLoading:!1}),l}catch(i){throw e({error:i instanceof Error?i.message:"Failed to update task",isLoading:!1}),i}},deleteTask:async a=>{e({isLoading:!0,error:null});try{const r=await fetch(`${s}/tasks/${a}`,{method:"DELETE"}),o=await r.json();if(!o.success)throw new Error(o.error?.message||"Failed to delete task");const i=t().tasks.filter(e=>e.id!==a);e({tasks:i,filteredTasks:t().applyFilters(i,t().filters),selectedTask:t().selectedTask?.id===a?null:t().selectedTask,isLoading:!1})}catch(r){throw e({error:r instanceof Error?r.message:"Failed to delete task",isLoading:!1}),r}},completeTask:async r=>{e({isLoading:!0,error:null});try{const o=await fetch(`${s}/tasks/${r}/complete`,{method:"PATCH"}),i=await o.json();if(!i.success)throw new Error(i.error?.message||"Failed to complete task");const d=i.data,n=a(d),l=t().tasks.map(e=>e.id===r?n:e);return e({tasks:l,filteredTasks:t().applyFilters(l,t().filters),selectedTask:t().selectedTask?.id===r?n:t().selectedTask,isLoading:!1}),n}catch(o){throw e({error:o instanceof Error?o.message:"Failed to complete task",isLoading:!1}),o}},setFilters:s=>{const a={...t().filters,...s},r=t().applyFilters(t().tasks,a);e({filters:a,filteredTasks:r})},setSelectedTask:t=>{e({selectedTask:t})},clearError:()=>{e({error:null})},getTasksByCategory:e=>t().tasks.filter(t=>t.categoryId===e),getTasksByStatus:e=>t().tasks.filter(t=>t.status===e),getOverdueTasks:()=>{const e=new Date;return t().tasks.filter(t=>t.dueDate&&t.dueDate<e&&"active"===t.status)},getDueTodayTasks:()=>{const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1);return t().tasks.filter(e=>e.dueDate&&e.dueDate>=s&&e.dueDate<a&&"active"===e.status)},applyFilters:(e,t)=>{let s=[...e];if(t.categoryId&&(s=s.filter(e=>e.categoryId===t.categoryId)),t.status&&(s=s.filter(e=>e.status===t.status)),t.priority&&(s=s.filter(e=>e.priority===t.priority)),t.searchQuery){const e=t.searchQuery.toLowerCase();s=s.filter(t=>t.title.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e))}return s}}),{name:"task-store"}));export{r as u};
//# sourceMappingURL=taskStore-LwOSsDkH.js.map
