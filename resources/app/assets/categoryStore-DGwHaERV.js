import{c as e,d as r}from"./vendor-state-Jewp0_hO.js";const t={categories:[],categoriesWithCounts:[],categoriesWithProgress:[],isLoading:!1,error:null,selectedCategory:null},a=e()(r((e,r)=>({...t,fetchCategories:async()=>{e({isLoading:!0,error:null});try{const r=await fetch("/api/categories"),t=await r.json();t.success&&t.data?e({categories:t.data,isLoading:!1}):e({error:t.error?.message||"Failed to fetch categories",isLoading:!1})}catch(r){e({error:r instanceof Error?r.message:"Network error",isLoading:!1})}},fetchCategoriesWithCounts:async()=>{e({isLoading:!0,error:null});try{const r=await fetch("/api/categories/with-counts"),t=await r.json();t.success&&t.data?e({categoriesWithCounts:t.data,categories:t.data,isLoading:!1}):e({error:t.error?.message||"Failed to fetch categories with counts",isLoading:!1})}catch(r){e({error:r instanceof Error?r.message:"Network error",isLoading:!1})}},fetchCategoriesWithProgress:async r=>{e({isLoading:!0,error:null});try{const t=r?`?weekStart=${r.toISOString()}`:"",a=await fetch(`/api/categories/with-progress${t}`),o=await a.json();o.success&&o.data?e({categoriesWithProgress:o.data,categories:o.data,isLoading:!1}):e({error:o.error?.message||"Failed to fetch categories with progress",isLoading:!1})}catch(t){e({error:t instanceof Error?t.message:"Network error",isLoading:!1})}},fetchCategoryById:async r=>{try{const t=await fetch(`/api/categories/${r}`),a=await t.json();return a.success&&a.data?a.data:(e({error:a.error?.message||"Failed to fetch category"}),null)}catch(t){return e({error:t instanceof Error?t.message:"Network error"}),null}},createCategory:async r=>{e({isLoading:!0,error:null});try{const t=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),a=await t.json();if(a.success&&a.data){const r=a.data;return e(e=>({categories:[...e.categories,r],categoriesWithCounts:[...e.categoriesWithCounts,{...r,taskCount:0}],categoriesWithProgress:[...e.categoriesWithProgress,{...r,weeklyProgress:0}],isLoading:!1})),r}return e({error:a.error?.message||"Failed to create category",isLoading:!1}),null}catch(t){return e({error:t instanceof Error?t.message:"Network error",isLoading:!1}),null}},updateCategory:async(r,t)=>{e({isLoading:!0,error:null});try{const a=await fetch(`/api/categories/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),o=await a.json();if(o.success&&o.data){const t=o.data;return e(e=>({categories:e.categories.map(e=>e.id===r?t:e),categoriesWithCounts:e.categoriesWithCounts.map(e=>e.id===r?{...t,taskCount:e.taskCount}:e),categoriesWithProgress:e.categoriesWithProgress.map(e=>e.id===r?{...t,weeklyProgress:e.weeklyProgress}:e),selectedCategory:e.selectedCategory?.id===r?t:e.selectedCategory,isLoading:!1})),t}return e({error:o.error?.message||"Failed to update category",isLoading:!1}),null}catch(a){return e({error:a instanceof Error?a.message:"Network error",isLoading:!1}),null}},deleteCategory:async(r,t)=>{e({isLoading:!0,error:null});try{const a=t?`?reassignTo=${t}`:"",o=await fetch(`/api/categories/${r}${a}`,{method:"DELETE"}),s=await o.json();return s.success?(e(e=>({categories:e.categories.filter(e=>e.id!==r),categoriesWithCounts:e.categoriesWithCounts.filter(e=>e.id!==r),categoriesWithProgress:e.categoriesWithProgress.filter(e=>e.id!==r),selectedCategory:e.selectedCategory?.id===r?null:e.selectedCategory,isLoading:!1})),!0):(e({error:s.error?.message||"Failed to delete category",isLoading:!1}),!1)}catch(a){return e({error:a instanceof Error?a.message:"Network error",isLoading:!1}),!1}},checkNameUnique:async(e,r)=>{try{const t=await fetch("/api/categories/check-name",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,excludeId:r})}),a=await t.json();return!(!a.success||!a.data)&&a.data.isUnique}catch(t){return!1}},selectCategory:r=>{e({selectedCategory:r})},clearError:()=>{e({error:null})},getCategoryById:e=>r().categories.find(r=>r.id===e),getCategoryByName:e=>r().categories.find(r=>r.name.toLowerCase()===e.toLowerCase())}),{name:"category-store"})),o=()=>a(e=>({categories:e.categories,categoriesWithCounts:e.categoriesWithCounts,categoriesWithProgress:e.categoriesWithProgress,isLoading:e.isLoading,error:e.error})),s=()=>a(e=>({fetchCategories:e.fetchCategories,fetchCategoriesWithCounts:e.fetchCategoriesWithCounts,fetchCategoriesWithProgress:e.fetchCategoriesWithProgress,fetchCategoryById:e.fetchCategoryById,createCategory:e.createCategory,updateCategory:e.updateCategory,deleteCategory:e.deleteCategory,checkNameUnique:e.checkNameUnique,selectCategory:e.selectCategory,clearError:e.clearError}));export{s as a,o as b,a as u};
//# sourceMappingURL=categoryStore-DGwHaERV.js.map
